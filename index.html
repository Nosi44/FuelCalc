<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Расход топлива на отопление</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f5f5f5;
  padding: 20px;
  max-width: 500px;
  margin: auto;
}

h1 {
  text-align: center;
}

label {
  display: block;
  margin-top: 15px;
  font-weight: bold;
}

select, input {
  width: 100%;
  padding: 6px;
  margin-top: 5px;
  font-size: 14px;
}

button {
  margin-top: 20px;
  width: 100%;
  padding: 10px;
  font-size: 15px;
  cursor: pointer;
}

.result {
  margin-top: 20px;
  font-size: 18px;
  font-weight: bold;
}

.coeff {
  margin-top: 10px;
  font-size: 14px;
  color: #555;
}

.status {
  margin-top: 10px;
  font-size: 14px;
  text-align: center;
  color: #444;
}
</style>
</head>

<body>

<h1>Расход топлива</h1>

<label>Порода дерева</label>
<select id="wood"></select>

<label>Среднесуточная температура</label>
<select id="temp"></select>

<label>Количество</label>
<input type="number" id="quantity" step="0.01">

<div class="coeff" id="coeff"></div>

<button onclick="calculate()">Посчитать</button>
<button onclick="saveState()">Сохранить</button>
<button onclick="loadState()">Загрузить</button>

<div class="result" id="result">Итого:</div>
<div class="status" id="status"></div>

<script>
const woodCoef = {
  "Смешаные":0.186,"Клен":0.262,"Граб":0.290,"Ясень":0.274,
  "Дуб":0.285,"Бук":0.253,"Береза":0.230,"Вяз":0.250,
  "Сосна":0.208,"Ольха":0.193,"Ель":0.178,"Осика":0.183,
  "Липа":0.179,"Пихта":0.175,"Тополь":0.146
};

const averageDayTemp = {
  "+8":0.43,"+7":0.47,"+6":0.51,"+5":0.555,
  "+4":0.60,"+3":0.645,"+2":0.69,"+1":0.73,
  "0":0.77,"-1":0.815,"-2":0.86,"-3":1,
  "-4":0.94,"-5":0.995,"-6":1.03,"-7":1.07,
  "-8":1.11,"-9":1.155,"-10":1.20,"-11":1.245,
  "-12":1.29,"-13":1.33,"-14":1.37,"-15":1.415,
  "-16":1.46,"-17":1.5,"-18":1.54,"-19":1.585,
  "-20":1.63,"-21":1.67,"-22":1.71,"-23":1.755,
  "-24":1.80,"-25":1.845,"-26":1.89,"-27":1.93,
  "-28":1.97,"-29":2.015,"-30":2.06
};

const woodSelect = document.getElementById("wood");
const tempSelect = document.getElementById("temp");
const coeffDiv = document.getElementById("coeff");
const resultDiv = document.getElementById("result");
const quantityInput = document.getElementById("quantity");

// Заполнение списков
Object.keys(woodCoef).forEach(w => {
  woodSelect.innerHTML += `<option value="${w}">${w}</option>`;
});

Object.keys(averageDayTemp).forEach(t => {
  tempSelect.innerHTML += `<option value="${t}">${t}</option>`;
});

// Обновление коэффициентов
function updateCoefficients() {
  const wood = woodSelect.value;
  const temp = tempSelect.value;

  const wood_k = woodCoef[wood];
  const temp_k = averageDayTemp[temp];

  coeffDiv.textContent = `Коэффициенты: ${wood_k} × ${temp_k}`;
}

// Расчёт
function calculate() {
  try {
    const wood = woodSelect.value;
    const temp = tempSelect.value;
    const quantity = parseFloat(quantityInput.value);

    const wood_k = woodCoef[wood];
    const temp_k = averageDayTemp[temp];

    const total = wood_k * temp_k * quantity;

    resultDiv.textContent = `Итого: ${total.toFixed(3)}`;
  } catch {
    resultDiv.textContent = "Ошибка: введите число";
  }
}

woodSelect.addEventListener("change", updateCoefficients);
tempSelect.addEventListener("change", updateCoefficients);
updateCoefficients();

// -------------------
// Сохранение
// -------------------
async function saveState() {
  if (!window.showSaveFilePicker) {
    alert("Браузер не поддерживает сохранение файлов");
    return;
  }

  const data = {
    wood: woodSelect.value,
    temp: tempSelect.value,
    quantity: quantityInput.value
  };

  try {
    const handle = await window.showSaveFilePicker({
      suggestedName: "fuel_calc.json",
      types: [{
        description: "JSON файл",
        accept: { "application/json": [".json"] }
      }]
    });

    const writable = await handle.createWritable();
    await writable.write(JSON.stringify(data, null, 2));
    await writable.close();

    document.getElementById("status").textContent = "Сохранено!";
  } catch {}
}

// -------------------
// Загрузка
// -------------------
async function loadState() {
  if (!window.showOpenFilePicker) {
    alert("Браузер не поддерживает загрузку файлов");
    return;
  }

  try {
    const [handle] = await window.showOpenFilePicker({
      types: [{
        description: "JSON файл",
        accept: { "application/json": [".json"] }
      }]
    });

    const file = await handle.getFile();
    const text = await file.text();
    const data = JSON.parse(text);

    woodSelect.value = data.wood;
    tempSelect.value = data.temp;
    quantityInput.value = data.quantity;

    updateCoefficients();
    calculate();

    document.getElementById("status").textContent = "Загружено!";
  } catch {}
}
</script>

</body>
</html>
