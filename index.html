<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Расход топлива (Октябрь–Март)</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f5f5f5;
  padding: 15px;
}

h1 {
  text-align: center;
}

.row {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 6px;
  background: #fff;
  padding: 8px;
  margin-bottom: 6px;
  border-radius: 6px;
}

.row strong {
  width: 80px;
}

input, select {
  width: 70px;
}

.result {
  font-weight: bold;
  width: 70px;
}

.total {
  text-align: center;
  font-size: 20px;
  font-weight: bold;
  margin-top: 15px;
}

.buttons {
  text-align: center;
  margin-top: 15px;
}

.status {
  text-align: center;
  margin-top: 8px;
  font-size: 14px;
}
</style>
</head>

<body>

<h1>Расход топлива</h1>

<div id="table"></div>

<div class="total" id="total">Сумма: 0.00 скл.м.</div>

<div class="buttons">
  <button onclick="saveState()">Сохранить</button>
  <button onclick="loadState()">Загрузить</button>
</div>

<div class="status" id="status"></div>

<input type="file" id="fileInput" accept=".json" style="display:none">

<script>
const tempCoef = {
  "+8":0.43,"+7":0.47,"+6":0.51,"+5":0.555,
  "+4":0.60,"+3":0.645,"+2":0.69,"+1":0.73,
  "0":0.77,"-1":0.815,"-2":0.86,"-3":0.90,
  "-4":0.94,"-5":0.995,"-6":1.03,"-7":1.07,
  "-8":1.11,"-9":1.155,"-10":1.20,"-11":1.245,
  "-12":1.29,"-13":1.33,"-14":1.37,"-15":1.415,
  "-16":1.46,"-17":1.50,"-18":1.54,"-19":1.585,
  "-20":1.63,"-21":1.67,"-22":1.71,"-23":1.755,
  "-24":1.80,"-25":1.845,"-26":1.89,"-27":1.93,
  "-28":1.97,"-29":2.015,"-30":2.06
};

const woodCoef = {
  "Смешаные":0.186,"Клен":0.262,"Граб":0.290,"Ясень":0.274,
  "Дуб":0.285,"Бук":0.253,"Береза":0.230,"Вяз":0.250,
  "Сосна":0.208,"Ольха":0.193,"Ель":0.178,"Осика":0.183,
  "Липа":0.179,"Пихта":0.175,"Тополь":0.146
};

const months = ["Октябрь","Ноябрь","Декабрь","Январь","Февраль","Март"];
const rows = [];

const table = document.getElementById("table");

months.forEach(month => {
  const row = document.createElement("div");
  row.className = "row";

  row.innerHTML = `
    <strong>${month}</strong>

    <select class="temp"></select> *
    <input type="number" class="area" value="25"> *
    <input type="number" class="days" value="30"> /
    <input type="number" class="burj" value="0.44"> /
    <select class="wood"></select> /
    <input type="number" class="last" value="1000"> =
    <span class="result">0.00</span>
    <label><input type="checkbox" class="enabled" checked> в сумму</label>
  `;

  table.appendChild(row);

  const tempSelect = row.querySelector(".temp");
  Object.keys(tempCoef).forEach(t => {
    tempSelect.innerHTML += `<option value="${t}">${t}</option>`;
  });

  const woodSelect = row.querySelector(".wood");
  Object.keys(woodCoef).forEach(w => {
    woodSelect.innerHTML += `<option value="${w}">${w}</option>`;
  });

  rows.push(row);
});

function calculateAll() {
  let total = 0;

  rows.forEach(row => {
    try {
      const a = tempCoef[row.querySelector(".temp").value];
      const b = parseFloat(row.querySelector(".area").value);
      const c = parseFloat(row.querySelector(".days").value);
      const d = parseFloat(row.querySelector(".burj").value);
      const e = woodCoef[row.querySelector(".wood").value];
      const f = parseFloat(row.querySelector(".last").value);

      const result = a * b * c / d / e / f;
      row.querySelector(".result").textContent = result.toFixed(2);

      if (row.querySelector(".enabled").checked) {
        total += result;
      }
    } catch {
      row.querySelector(".result").textContent = "...";
    }
  });

  document.getElementById("total").textContent =
    `Сумма: ${total.toFixed(2)} скл.м.`;
}

document.addEventListener("input", calculateAll);
document.addEventListener("change", calculateAll);
calculateAll();

// ---------- Сохранение ----------
function saveState() {
  const data = rows.map(row => ({
    temp: row.querySelector(".temp").value,
    area: row.querySelector(".area").value,
    days: row.querySelector(".days").value,
    burj: row.querySelector(".burj").value,
    wood: row.querySelector(".wood").value,
    last: row.querySelector(".last").value,
    enabled: row.querySelector(".enabled").checked
  }));

  const blob = new Blob([JSON.stringify(data, null, 2)], {type:"application/json"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "fuel_calc.json";
  a.click();

  document.getElementById("status").textContent = "Сохранено!";
}

// ---------- Загрузка ----------
function loadState() {
  document.getElementById("fileInput").click();
}

document.getElementById("fileInput").addEventListener("change", e => {
  const file = e.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = () => {
    const data = JSON.parse(reader.result);

    data.forEach((saved, i) => {
      const row = rows[i];
      if (!row) return;

      row.querySelector(".temp").value = saved.temp;
      row.querySelector(".area").value = saved.area;
      row.querySelector(".days").value = saved.days;
      row.querySelector(".burj").value = saved.burj;
      row.querySelector(".wood").value = saved.wood;
      row.querySelector(".last").value = saved.last;
      row.querySelector(".enabled").checked = saved.enabled;
    });

    calculateAll();
    document.getElementById("status").textContent = "Загружено!";
  };
  reader.readAsText(file);
});
</script>

</body>
</html>
